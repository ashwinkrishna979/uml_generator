{% extends 'base.html' %}

{% block content %}


<style>
  table {
      border-collapse: collapse;
      width: 100%;
  }
  
  th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: left;
  }
  
  th {
      background-color: #f2f2f2;
  }
</style>


<script>
  function validateInput(input) {
      // Regular expression to match valid characters
      var validCharacters = /^[A-Za-z0-9_]+$/;

      if (!input.value.match(validCharacters)) {
          alert("Invalid input. Please use only letters, numbers, and underscores.");
          input.value = input.value.replace(/[^A-Za-z0-9_]/g, ''); // Remove invalid characters
      }
  }


  
  document.addEventListener('DOMContentLoaded', function () {
      const deleteButtons = document.querySelectorAll('.delete-button');
      
      deleteButtons.forEach(button => {
          button.addEventListener('click', function () {
              const itemId = button.getAttribute('data-item-id');
              if (confirm("Are you sure you want to delete this item?")) {
                  fetch(`/delete_item/${itemId}/`, {
                      method: 'DELETE',
                      headers: {
                          'X-Requested-With': 'XMLHttpRequest',
                          'X-CSRFToken': '{{ csrf_token }}'
                      }
                  })
                  .then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          
                          const row = document.querySelector(`tr[data-item-id="${itemId}"]`);
                          if (row) {
                              console.log('Removing row');
                              row.remove();
                          }
                      } else {
                          console.error('Error deleting item:', data.error);
                      }
                  })
                  .catch(error => {
                      console.error('AJAX request error:', error);
                  });
              }
          });
      });
  });












</script>



<div class=" col-md-6 offset-md-3">



<h1> UML CONVERTER </h1>

<form method="POST" action="{%url 'home'%}">
    {% csrf_token %}

      <div class="mb-3">
        <label for="selection" class="form-label">Choose the coverter:</label>
        <select name="selection" id="selection" required>
          <option value="knn">knn based usecase diagram generator</option>
          <option value="use_case_llm">Flan based usecase diagram generator</option>
        </select>
        <br/>
        <br/>
        
        <label for="textArea1label" class="form-label">Input Functional Requirements:</label>
        <textarea class="form-control" name="textArea1" id="textArea1" rows="5" placeholder="Enter Requirements" required>{{ input_txt }}</textarea>
        <br/>
        <button type="submit" name="action" value="make" class="btn btn-dark">Make UML</button>
      </div>
      <br/>

      <div class="mb-3">
        <table>
          <thead>
              <tr>
                  <th>ACTOR</th>
                  <th>USECASE</th>
                  <th>SENTENCE</th>
                  <th>DELETE</th>
              </tr>
          </thead>
          <tbody>
              {% for item in items %}
                  <tr data-item-id="{{ item.id }}">
                      <td><input type="text" name='actor_{{ item.id }}' oninput="validateInput(this)" value="{{ item.actor}}"></td>
                      <td><input type="text" name='usecase_{{ item.id }}' oninput="validateInput(this)" value="{{ item.usecase}}"></td>
                      <td><input type="text" name='sentence_{{ item.id }}' value="{{ item.sentence}}"></td>
                      <td>
                        <button type="button" class="delete-button" data-item-id="{{ item.id }}">Delete</button>
                    </td>
                  </tr>
              {% endfor %}
          </tbody>
        </table>
        <br/>

        <button type="submit" name="action" class="btn btn-dark" value="correct">Correct UML</button>
        <br/>
        <br/>
      </div>




      <div class="mb-3">
        <label for="diagram" class="form-label">Usecase Diagram:</label>
        <br/>
        <img name= "diagram" src="puml" alt="Usecase Diagram">
        <br/>

        <button type="submit" name="action" class="btn btn-dark" value="download">Download Image</button>
        <br/>
        <br/>


      </div>


    

    

</form>




</div>

{% endblock%}